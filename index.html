<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Contesto AI - Puter.js Edition</title>

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://js.puter.com/v2/"></script>

<style>
@import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap');

/* 
Prima che qualcuno mi flagelli ho voluto tenere tutto in un file 
perch√© non funzionava nulla se dividevo in pi√π parti, 
non sono riuscito a capire bene il motivo ma per ora va bene cos√¨, 
se in futuro riesco a sistemare tutto allora magari lo divider√≤ in pi√π file, 
ma per ora √® un unico blocco di codice, spero che non dia troppo fastidio :D
*/

/* Stile generale */
:root {
    --primaryColor: #0061a4;
    --surfaceColor: #fdfbff;
    --outlineColor: #74777f;
}

body { 
    font-family: 'Roboto', sans-serif; 
    background-color: var(--surfaceColor); 
    margin: 0; 
    padding: 0; 
    display: flex;
    flex-direction: column;
    align-items: center;
}

/* Animazione titolo "snake wave" */
@keyframes snakeWave {
    0%,100%{transform: translateY(0);}
    50%{transform: translateY(-12px);}
}
.wave-text span { display:inline-block; animation:snakeWave 1.2s infinite ease-in-out; }

/* Guess row */
.guess-row { 
    border-radius: 16px; 
    margin-bottom: 8px; 
    padding: 12px 16px; 
    display: flex; 
    justify-content: space-between; 
    align-items: center; 
    position: relative; 
    overflow: hidden; 
    background-color: white; 
    border: 1px solid rgba(0,0,0,0.05); 
}
.progress-bg { position: absolute; left:0; top:0; bottom:0; z-index:0; transition: width 1s ease; }
.content-z { position:relative; z-index:1; display:flex; justify-content:space-between; width:100%; }

/* Input e pulsante */
.input-rounded { border-radius:100px; border:2px solid var(--outlineColor); padding:16px 24px; outline:none; width:100%; }
.btn-main { border-radius:20px; padding:16px; background-color:var(--primaryColor); color:white; min-width:56px; display:flex; align-items:center; justify-content:center; cursor:pointer; }

/* AI Panel */
.ai-panel { background-color:#e1e2ec; border-radius:24px; padding:20px; margin-top:20px; display:none; }
.ai-panel.visible { display:block; }
.loader { border:3px solid rgba(255,255,255,0.3); border-top:3px solid white; border-radius:50%; width:24px; height:24px; animation: spin 0.8s linear infinite; display:none; }
@keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

/* Layout responsive */
header, main { width:100%; max-width:600px; }
footer { position: fixed; bottom:0; left:0; right:0; padding:16px; background:white/90; backdrop-blur:8px; border-top:1px solid rgba(0,0,0,0.05); display:flex; justify-content:center; z-index:50; }

/* Pannello statistiche creativo */
#stats-btn { position: fixed; bottom:96px; right:24px; width:48px; height:48px; border-radius:50%; background:var(--primaryColor); color:white; display:flex; align-items:center; justify-content:center; cursor:pointer; z-index:60; }
#stats-panel { position: fixed; bottom:0; left:0; right:0; max-width:600px; margin:auto; background:white; border-radius:2rem 2rem 0 0; padding:24px; transform:translateY(100%); transition: transform 0.3s; z-index:55; }
</style>
</head>

<body class="flex flex-col items-center min-h-screen p-4 pb-32">

<header class="text-center mb-8 mt-6">
    <h1 id="wave-title" class="wave-text text-5xl font-bold text-slate-800 mb-2"></h1>
    <p class="opacity-60 text-sm">Alimentato da Puter.js con Gemini</p>
</header>

<main class="w-full max-w-md flex flex-col items-center">
    <div id="ai-box" class="ai-panel mb-6 border">
        <div class="flex items-center gap-2 mb-2">
            <span>‚ú®</span>
            <span id="ai-label" class="text-xs font-bold uppercase tracking-wider text-slate-500">Assistente AI</span>
        </div>
        <p id="ai-text" class="text-sm italic text-slate-700"></p>
    </div>

    <div id="list-attempts" class="flex flex-col-reverse w-full"></div>

    <div id="empty-msg" class="py-24 text-center opacity-30">
        <p class="text-xl">Digita una parola</p>
    </div>
</main>

<footer class="flex gap-3 w-full max-w-md">
    <input type="text" id="input-word" placeholder="Prova una parola..." class="input-rounded">
    <button id="btn-send" class="btn-main">
        <div class="loader" id="spin-loader"></div>
        <span id="icon-send">‚ûî</span>
    </button>
</footer>

<!-- Bottone e pannello statistiche -->
<div id="stats-btn">üìä</div>
<div id="stats-panel">
    <div class="flex justify-between items-center mb-4">
        <h2 class="text-lg font-bold text-slate-800">Statistiche Personali</h2>
        <button onclick="toggleStatsPanel()" class="text-slate-400 font-bold text-xl">‚úï</button>
    </div>
    <div class="flex flex-col gap-2 text-slate-700">
        <p><strong>Partita corrente:</strong> <span id="stat-current-attempts">0</span> tentativi</p>
        <p><strong>Vittorie totali:</strong> <span id="stat-total-wins">0</span></p>
        <p><strong>Miglior partita:</strong> <span id="stat-best-attempts">‚Äì</span> tentativi</p>
    </div>
</div>
<!-- Pannello Musica -->
<div id="music-overlay" onclick="closeMusicPanel()"></div>
<div id="music-btn">üéµ</div>
<div id="music-panel" class="fixed bottom-[-110%] left-1/2 transform -translate-x-1/2 w-full max-w-md bg-white rounded-2xl shadow-lg p-6 transition-all z-50">
    <div class="flex justify-between items-center mb-4">
        <h3 class="font-bold text-lg">Music Player</h3>
        <button onclick="closeMusicPanel()" class="text-gray-500 font-bold text-xl">‚úï</button>
    </div>
    <div class="flex gap-2 mb-4">
        <input type="text" id="yt-url" placeholder="Incolla link YouTube..." class="input-rounded flex-1">
        <button onclick="loadVideo()" class="btn-main">CARICA</button>
    </div>
    <div class="aspect-video w-full bg-black rounded-xl overflow-hidden">
        <div id="player"></div>
    </div>
</div>
<script>
/* --- Animazione titolo --- 
aggiungo come io abbia rubato tutto da un mio altro 
progetto che copiava a sua volta lo stile di google */
const t = "Contesto AI"; const tc = document.getElementById('wave-title');
t.split("").forEach((c,i)=>{const s=document.createElement("span"); s.innerText=c; s.style.animationDelay=`${i*0.08}s`; tc.appendChild(s);});

/* --- Variabili di gioco --- */
let paroleSegrete = [];
let parolaDaIndovinare = "";
let partitaInCorso = false;
let storicoTentativi = [];
let livelloIndizio = 0;
let ultimoIndizio = 0;
/* --- Player Musicale ---*/
var player;
function onYouTubeIframeAPIReady(){player=new YT.Player('player',{height:'100%',width:'100%',videoId:'n61ULEU7CO0',playerVars:{'autoplay':0,'controls':1,'modestbranding':1,'rel':0}});}
var tag=document.createElement('script'); tag.src="https://www.youtube.com/iframe_api"; document.head.appendChild(tag);

function openMusicPanel(){document.getElementById('music-panel').style.bottom="0"; document.getElementById('music-overlay').classList.add('visible');}
function closeMusicPanel(){document.getElementById('music-panel').style.bottom="-110%"; document.getElementById('music-overlay').classList.remove('visible');}
function loadVideo(){let input=document.getElementById('yt-url').value; const regExp=/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/; const match=input.match(regExp); if(match&&match[2].length==11)player.loadVideoById(match[2]);}

document.getElementById('music-btn').onclick = openMusicPanel;

/* --- Statistiche in locale --- */
const LOCAL_STATS_KEY = "contestoAI_stats";
let stats = { totalWins:0, bestAttempts:null };
function loadStats(){const s=localStorage.getItem(LOCAL_STATS_KEY); if(s) stats=JSON.parse(s); updateStatsUI();}
function saveStats(){localStorage.setItem(LOCAL_STATS_KEY, JSON.stringify(stats));}
function updateStatsUI(){document.getElementById("stat-total-wins").innerText=stats.totalWins; document.getElementById("stat-best-attempts").innerText=stats.bestAttempts!==null?stats.bestAttempts:"‚Äì"; document.getElementById("stat-current-attempts").innerText=storicoTentativi.length;}
function toggleStatsPanel(){const p=document.getElementById("stats-panel"); p.style.transform = (p.style.transform==="translateY(0%)")?"translateY(100%)":"translateY(0%)";}
function recordWin(){stats.totalWins++; if(stats.bestAttempts===null || storicoTentativi.length<stats.bestAttempts) stats.bestAttempts=storicoTentativi.length; saveStats(); updateStatsUI();}

/* --- Elementi UI --- */
const ui = {
    input: document.getElementById("input-word"),
    sendBtn: document.getElementById("btn-send"),
    loader: document.getElementById("spin-loader"),
    icon: document.getElementById("icon-send"),
    list: document.getElementById("list-attempts"),
    empty: document.getElementById("empty-msg"),
    aiBox: document.getElementById("ai-box"),
    aiText: document.getElementById("ai-text"),
    aiLabel: document.getElementById("ai-label"),
};


/* --- Caricamento parole da file esterno --- 
l'unica cosa che ho effettivamente 
diviso dal resto perch√© stranamente non ha rotto nulla XD<*/
fetch('words.json')
.then(r=>r.json())
.then(data=>{paroleSegrete=data; avviaNuovaPartita();});

/* --- Funzioni principali --- */
function avviaNuovaPartita(){
    const index = Math.floor(Math.random()*paroleSegrete.length);
    parolaDaIndovinare = paroleSegrete[index];
    partitaInCorso = true; storicoTentativi=[]; livelloIndizio=0;
    ui.list.innerHTML=""; ui.aiBox.classList.remove("visible"); ui.empty.style.display="flex"; ui.input.value="";
    console.log("Nuova parola:", parolaDaIndovinare);
    updateStatsUI();
}

async function aiChat(prompt){await puter.ready; const res=await puter.ai.chat({prompt,model:"gemini-pro"}); return res.message.content;}
async function calcolaDistanzaAI(parolaUtente){
    if(parolaUtente===parolaDaIndovinare) return 1;
    try{const testo=await aiChat(`Calcola la distanza semantica tra "${parolaUtente}" e "${parolaDaIndovinare}". Rispondi solo con un numero tra 2 e 15000.`); return parseInt(testo.replace(/\D/g,"")) || 3000;}
    catch{return Math.abs(parolaUtente.length-parolaDaIndovinare.length)*500+2000;}
}

function feedbackTestuale(d){if(d===1) return "üèÜ Vittoria"; if(d<800) return "üî• Bollente"; if(d<3000) return "üôÇ Vicino"; if(d<7000) return "üòê Lontano"; return "üßä Ghiacciato";}

async function gestisciInvio(){
    const parola = ui.input.value.trim().toLowerCase();
    if(!parola||!partitaInCorso) return;

    ui.loader.style.display="block"; ui.icon.style.display="none";
    const distanza = await calcolaDistanzaAI(parola);
    ui.loader.style.display="none"; ui.icon.style.display="block"; ui.input.value="";
    ui.empty.style.display="none";

    storicoTentativi.push({ parola,distanza }); aggiungiRiga(parola,distanza);
    ui.aiBox.classList.add("visible"); ui.aiText.innerText=feedbackTestuale(distanza);
    updateStatsUI();

    if(distanza===1){finePartita();}
}
/* Aggiunge una riga ogni volta, cos√¨ da evitare che tutto si raggruppi in una sottospecie di orgia*/
function aggiungiRiga(parola,distanza){
    const percentuale = Math.max(5, 100-(distanza/15000*100));
    let colore = distanza===1?"#22c55e":distanza<1000?"#4ade80":"#facc15";
    const div = document.createElement("div");
    div.className="guess-row shadow-sm";
    div.innerHTML=`<div class="progress-bg" style="width:${percentuale}%;background:${colore};opacity:.3"></div>
    <div class="content-z font-bold"><span>${parola}</span><span>${feedbackTestuale(distanza)}</span></div>`;
    ui.list.appendChild(div);
}

function finePartita(){partitaInCorso=false; ui.aiText.innerText="Grande! Hai trovato la parola: "+parolaDaIndovinare; ui.aiBox.classList.add("visible"); recordWin();}

/* --- Eventi --- */
ui.sendBtn.onclick = gestisciInvio;
ui.input.addEventListener("keydown", e=>e.key==="Enter"&&gestisciInvio());

loadStats();
</script>
</body>
</html>
